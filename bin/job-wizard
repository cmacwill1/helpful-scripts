#!/bin/bash
############################################################
Help()
{
   # Display Help
   echo "This script lists the jobs for the user on the current cluster."
   echo
   echo "Usage: $(basename "$0") [options]"
   echo "options:"
   echo "  -u, --user   Specify a different user."
   echo "  -h, --help   Print this help."
   echo
}
############################################################
if [ $# -ne 1 ]; then
  echo "Usage: $0 <filename.inp>"
  exit 1
fi

if [ ! -f "$1" ]; then
  echo "Error: File '$1' does not exist."
  exit 1
fi

if [[ "$1" != *.inp ]]; then
  echo "Error: This job wizard only supports ABAQUS .inp files"
  exit 1
fi

if [ -d "/anvil/projects/x-$ALLOCATION/jobs/" ]; then
  :
else
  echo "No jobs directory! Making..."
  mkdir /anvil/projects/x-$ALLOCATION/jobs/
  echo "Done"
fi

read -p "Enter a new name for this job (no spaces or . please!):" USER_INPUT

if [ -n "$USER_INPUT" ]; then
  FILE = "$USER_INPUT.inp"
  mv "$1" ./"$FILE"
else
  FILE = "$1"
fi

if [ -d "/anvil/projects/x-$ALLOCATION/jobs/${FILE%.*}" ]; then
  echo "Error: A job for $FILE already exists! Please choose a unique name"
else
  mkdir /anvil/projects/x-$ALLOCATION/jobs/${FILE%.*}
  mv "$FILE" /anvil/projects/x-$ALLOCATION/jobs/${FILE%.*}
  cd /anvil/projects/x-$ALLOCATION/jobs/${FILE%.*}
fi
