#!/bin/bash
############################################################
Help()
{
   # Display Help
   echo "This script lists the jobs for the user on the current cluster."
   echo
   echo "Usage: $(basename "$0") [options]"
   echo "options:"
   echo "  -u, --user   Specify a different user."
   echo "  -h, --help   Print this help."
   echo
}
############################################################
user="$USER"
while [[ $# -gt 0 ]]; do
  case "$1" in
	 -u|--user)
		 user="$2"
      shift 2
		 ;;
    -h|--help)
      Help
      exit 0
      ;;
	 *)
		 echo "Invalid option: $1."
		 exit 1
	 ;;
  esac
done

jobs=$(squeue -u "$user" | awk 'NR>1')

if [ -z "$jobs" ]; then
	echo "User $user does not have any jobs running on ${HOSTNAME#*.}"
else
	echo "$jobs" | while read line; do
		jobid=$(echo "$line" | awk '{print $1}')
		echo "Stats for job: $jobid on ${HOSTNAME#*.}"
		jobinfo "$jobid" #| grep Nodes | awk '{print $3}'
	done
fi
